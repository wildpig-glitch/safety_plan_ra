#! /bin/bash

set -euo pipefail

ROOT=$(cd "$(dirname "$0")/.."; pwd)
DEST="$ROOT/packages"

rm -rf "$DEST"
mkdir "$DEST"

add-package () {
  PACKAGE="$1"

  # Remove '@org/' part (e.g. '@atlassian/') in package name
  # See https://www.gnu.org/software/bash/manual/bash.html#Shell-Parameter-Expansion
  TARGET="${PACKAGE/#@*\//}"

  cp -R "$ROOT/../../node_modules/$1" "$DEST/$TARGET"
}

add-package @atlassian/ari
add-package @atlassian/logger-interface
add-package @atlassian/in-memory-metrics
add-package @atlassian/metrics-interface
add-package @atlassiansox/analytics-node-client

node ./scripts/replace-packages.js
